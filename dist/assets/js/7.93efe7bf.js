(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{147:function(a,t,s){"use strict";s.r(t);var e=s(0),n=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"实战：elk日志分析系统"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实战：elk日志分析系统","aria-hidden":"true"}},[a._v("#")]),a._v(" 实战：ELK日志分析系统")]),a._v(" "),s("p",[a._v("ElasticSearch、Logstash、Kibana简称ELK系统，主要用于日志的收集与分析。")]),a._v(" "),s("p",[a._v("一个完整的大型分布式系统，会有很多与业务不相关的系统，其中日志系统是不可或缺的一个，集中式日志系统需要收集来自不同服务的日志，对它进行集中管理存储以及分析。ELK就是这样一个系统。")]),a._v(" "),s("p",[a._v("ElasticSearch是一个开源分布式搜索引擎，在ELK系统中提供对数据的搜索、分析、存储。")]),a._v(" "),s("p",[a._v("Logstash主要用于日志的收集，在ELK系统中作为日志数据源的传输。")]),a._v(" "),s("p",[a._v("Kibana则是一个可视化管理工具，在ELK系统中起可视化分析查看的作用。")]),a._v(" "),s("h2",{attrs:{id:"安装部署elk"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装部署elk","aria-hidden":"true"}},[a._v("#")]),a._v(" 安装部署ELK")]),a._v(" "),s("h3",{attrs:{id:"elasticsearch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#elasticsearch","aria-hidden":"true"}},[a._v("#")]),a._v(" ElasticSearch")]),a._v(" "),s("p",[a._v('ElasticSearch的安装在"准备工作"中已经说明，这里不再赘述。')]),a._v(" "),s("h3",{attrs:{id:"kibana"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kibana","aria-hidden":"true"}},[a._v("#")]),a._v(" Kibana")]),a._v(" "),s("p",[a._v("Kibana6.3.2下载地址（Linux、mac OS、Windows对应不同的版本）："),s("a",{attrs:{href:"https://www.elastic.co/cn/downloads/past-releases/logstash-6-3-2",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://www.elastic.co/cn/downloads/past-releases/kibana-6-3-2"),s("OutboundLink")],1),a._v("。Logstatsh历史版本下载页面："),s("a",{attrs:{href:"https://www.elastic.co/cn/downloads/past-releases#kibana",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://www.elastic.co/cn/downloads/past-releases#kibana"),s("OutboundLink")],1),a._v("。")]),a._v(" "),s("h4",{attrs:{id:"mac-os"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#mac-os","aria-hidden":"true"}},[a._v("#")]),a._v(" mac OS")]),a._v(" "),s("ol",[s("li",[a._v("通过命令"),s("code",[a._v("tar -zxvf kibana-6.3.2-darwin-x86_64.tar.gz")]),a._v("解压到当前用户目录(或者其它位置)。")]),a._v(" "),s("li",[a._v("解压后进入"),s("code",[a._v("kibana-6.3.2-darwin-x86_64")]),a._v("目录，执行"),s("code",[a._v("vim config/kibana.yml")]),a._v("命令，修改配置（注意"),s("code",[a._v("yml")]),a._v("格式的配置文件冒号必须有英文空格。")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('server.port: 5601\nserver.host: "localhost"\nelasticsearch.url: "http://localhost:9200"\nlogging.dest: /Users/yulinfeng/log/kibana.log\n')])])]),s("ol",{attrs:{start:"3"}},[s("li",[a._v("执行"),s("code",[a._v("./bin/kibana")]),a._v("命令启动Kibana。")])]),a._v(" "),s("p",[a._v("启动完成，打开浏览器输入"),s("code",[a._v("localhost:5061")]),a._v("。")]),a._v(" "),s("p",[s("img",{attrs:{src:"resources/kibana.png",alt:"kibana"}})]),a._v(" "),s("h4",{attrs:{id:"linux"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#linux","aria-hidden":"true"}},[a._v("#")]),a._v(" Linux")]),a._v(" "),s("p",[a._v("安装过程同mac OS。")]),a._v(" "),s("h3",{attrs:{id:"logstash"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#logstash","aria-hidden":"true"}},[a._v("#")]),a._v(" Logstash")]),a._v(" "),s("p",[a._v("Logstash6.3.2下载地址（Linux、mac OS、Windows通用，下载zip包即可）："),s("a",{attrs:{href:"https://www.elastic.co/cn/downloads/past-releases/logstash-6-3-2",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://www.elastic.co/cn/downloads/past-releases/logstash-6-3-2"),s("OutboundLink")],1),a._v("。Logstash历史版本下载页面："),s("a",{attrs:{href:"https://www.elastic.co/cn/downloads/past-releases#logstash",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://www.elastic.co/cn/downloads/past-releases#logstash"),s("OutboundLink")],1),a._v("。")]),a._v(" "),s("h4",{attrs:{id:"macos"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#macos","aria-hidden":"true"}},[a._v("#")]),a._v(" macOS")]),a._v(" "),s("ol",[s("li",[a._v("解压"),s("code",[a._v("logstash-6.3.2.zip")]),a._v(" 解压到当前用户目录(或者其它位置)")]),a._v(" "),s("li",[a._v("解压后进入"),s("code",[a._v("logstash-6.3.2")]),a._v("目录，执行"),s("code",[a._v("vim logstash.conf")]),a._v("配置文件。")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('input {\n  tcp {\n    mode => "server"\n    host => "127.0.0.1"\n    port => 4568\n  }\n}\noutput {\n  elasticsearch {\n    hosts => ["localhost:9200"]\n    index => "log"\n    document_type => "log4j2"\n  }\n}\n')])])]),s("p",[a._v("这个配置的含义为，Logstash的日志采集来源是"),s("code",[a._v("4568")]),a._v("端口（后面我们会通过程序代码通过log4j向端口"),s("code",[a._v("4568")]),a._v("打印日志）。Logstash的日志向ElasticSearch输出。")]),a._v(" "),s("ol",{attrs:{start:"3"}},[s("li",[a._v("执行"),s("code",[a._v("./bin/logstash -f logstash.conf")]),a._v("命令启动Logstash。")])]),a._v(" "),s("h4",{attrs:{id:"linux-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#linux-2","aria-hidden":"true"}},[a._v("#")]),a._v(" Linux")]),a._v(" "),s("p",[a._v("安装过程同mac OS。")]),a._v(" "),s("h2",{attrs:{id:"日志源demo"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#日志源demo","aria-hidden":"true"}},[a._v("#")]),a._v(" 日志源DEMO")]),a._v(" "),s("p",[a._v("在部署Logstash时，我们定义了日志的来源是端口"),s("code",[a._v("4568")]),a._v("，接下来我们模拟一个程序利用log4j2通过socket连接将日志发送到"),s("code",[a._v("4568")]),a._v("端口，DEMO完整代码地址："),s("a",{attrs:{href:"https://github.com/yu-linfeng/elasticsearch6.x_tutorial/tree/master/code/logstash",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/yu-linfeng/elasticsearch6.x_tutorial/tree/master/code/logstash"),s("OutboundLink")],1),a._v("。")]),a._v(" "),s("p",[a._v("DEMO的逻辑只有打印日志，主要在"),s("code",[a._v("log4j2.xml")]),a._v("需要配置socket方式打印。")]),a._v(" "),s("div",{staticClass:"language-xml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-xml"}},[s("code",[a._v("......\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("Socket")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("name")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("logstash-tcp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("host")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("localhost"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("port")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("4568"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("protocol")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("TCP"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("PatternLayout")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token attr-name"}},[a._v("pattern")]),s("span",{pre:!0,attrs:{class:"token attr-value"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')]),a._v("${LOG_PATTERN}"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v('"')])]),a._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("/>")])]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token tag"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("Socket")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n......\n")])])]),s("p",[a._v("详细代码直接查看源码"),s("a",{attrs:{href:"https://github.com/yu-linfeng/elasticsearch6.x_tutorial/tree/master/code/logstash",target:"_blank",rel:"noopener noreferrer"}},[a._v("https://github.com/yu-linfeng/elasticsearch6.x_tutorial/tree/master/code/logstash"),s("OutboundLink")],1),a._v("。")]),a._v(" "),s("p",[a._v("启动Spring Boot程序后，控制台开始输出日志，此时返回浏览器查看"),s("code",[a._v("localhost:5061")]),a._v("，点击"),s("code",[a._v("Management")]),a._v("菜单，"),s("code",[a._v("Index pattern")]),a._v('中输入"log"(即定义的索引Index)，一直下一步即可。')]),a._v(" "),s("p",[s("img",{attrs:{src:"resources/kibana-man.png",alt:"kibana-man"}})]),a._v(" "),s("p",[a._v("配置完成后，点击"),s("code",[a._v("Discover")]),a._v("菜单，就可看到程序DEMO打印的日志，并可进行搜索。现在，就请尽情探索吧。")])])}),[],!1,null,null,null);t.default=n.exports}}]);