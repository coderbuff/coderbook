<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基本术语 | CoderBook</title>
    <meta name="description" content="CoderBook">
    
    
    <link rel="preload" href="/coderbook/assets/css/0.styles.414cd468.css" as="style"><link rel="preload" href="/coderbook/assets/js/app.c13df526.js" as="script"><link rel="preload" href="/coderbook/assets/js/2.a6e63a56.js" as="script"><link rel="preload" href="/coderbook/assets/js/10.b2155ceb.js" as="script"><link rel="preload" href="/coderbook/assets/js/4.304fbc0d.js" as="script"><link rel="prefetch" href="/coderbook/assets/js/11.9be892b8.js"><link rel="prefetch" href="/coderbook/assets/js/12.f3d24f47.js"><link rel="prefetch" href="/coderbook/assets/js/13.7bc98a18.js"><link rel="prefetch" href="/coderbook/assets/js/14.0529493e.js"><link rel="prefetch" href="/coderbook/assets/js/15.0d920bcb.js"><link rel="prefetch" href="/coderbook/assets/js/16.989baa8d.js"><link rel="prefetch" href="/coderbook/assets/js/17.0a3009c1.js"><link rel="prefetch" href="/coderbook/assets/js/18.9db74eb9.js"><link rel="prefetch" href="/coderbook/assets/js/19.fc85f6ab.js"><link rel="prefetch" href="/coderbook/assets/js/3.1f9a9b51.js"><link rel="prefetch" href="/coderbook/assets/js/5.8242e3e9.js"><link rel="prefetch" href="/coderbook/assets/js/6.6f51fff7.js"><link rel="prefetch" href="/coderbook/assets/js/7.00cc9041.js"><link rel="prefetch" href="/coderbook/assets/js/8.f74d170c.js"><link rel="prefetch" href="/coderbook/assets/js/9.02a78848.js">
    <link rel="stylesheet" href="/coderbook/assets/css/0.styles.414cd468.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/coderbook/" class="home-link router-link-active"><!----> <span class="site-name">CoderBook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/coderbook/" class="nav-link">首页</a></div><div class="nav-item"><a href="/coderbook/es6/index.html" class="nav-link">ElasticSearch6.x</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/coderbook/" class="nav-link">首页</a></div><div class="nav-item"><a href="/coderbook/es6/index.html" class="nav-link">ElasticSearch6.x</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/coderbook/es6/" class="sidebar-link">写在前面的话</a></li><li><a href="/coderbook/es6/chapter1.html" class="sidebar-link">准备工作</a></li><li><a href="/coderbook/es6/chapter2.html" class="active sidebar-link">基本术语</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/coderbook/es6/chapter3.html" class="sidebar-link">简单的API</a></li><li><a href="/coderbook/es6/chapter4.html" class="sidebar-link">分词</a></li><li><a href="/coderbook/es6/chapter5.html" class="sidebar-link">简单搜索</a></li><li><a href="/coderbook/es6/chapter6.html" class="sidebar-link">Java客户端（上）</a></li><li><a href="/coderbook/es6/chapter7.html" class="sidebar-link">父-子关系文档</a></li><li><a href="/coderbook/es6/chapter8.html" class="sidebar-link">复杂搜索</a></li><li><a href="/coderbook/es6/chapter9.html" class="sidebar-link">Java客户端（下）</a></li><li><a href="/coderbook/es6/chapter10.html" class="sidebar-link">实战：ELK日志分析系统</a></li><li><a href="/coderbook/es6/chapter11.html" class="sidebar-link">实战：多数据源同步</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="基本术语"><a href="#基本术语" class="header-anchor">#</a> 基本术语</h1> <blockquote><p>白马非马</p></blockquote> <p>ES是一个搜索引擎，同时它也是一个分布式文档存储数据库（当然是非关系型的）。为了保证后续的实战教程顺利进行，这里通过对比传统的关系型数据库MySQL介绍在ES中的一些术语。</p> <p>在MySQL中共有数据库（Database）、表（Table）、记录（Row）、列（Column）的概念，同样在ES中也有类似的概念，索引（Index），类型（Type），文档（Document），字段（Field）。</p> <p>可以这么理解：</p> <table><thead><tr><th></th> <th>数据库</th> <th>表</th> <th>记录</th> <th>列</th></tr></thead> <tbody><tr><td>MySQL</td> <td>DB</td> <td>Table</td> <td>Row</td> <td>Column</td></tr> <tr><td>ES</td> <td>Index</td> <td>Document</td> <td>Document</td> <td>Field</td></tr></tbody></table> <h3 id="索引index"><a href="#索引index" class="header-anchor">#</a> 索引Index</h3> <p>ES中的索引概念可不是关系型数据库中的“索引”，ES中的索引指的是存储数据的地方，类似关系型数据库中的数据库概念。</p> <h3 id="类型type"><a href="#类型type" class="header-anchor">#</a> 类型Type</h3> <p>有的文章指出ES中的类型Type对应的就是关系型数据库中的表，在使用ES中我们会遇到另外一个概念<strong>映射（Mapping）</strong>，也有不少的文章指出Mapping对应的就是关系型数据库中的表。关系型数据库中表与表是物理独立的，即使在两个表中存在相同名称不同类型的列，这在我们的关系型数据库也是极为合理的，但这在ES中就不合理，ES中即使是在同一个索引Index下，如果字段Field存在于不同的类型Type中，即使他们代表不同的含义，但是只要它们的<strong>名称相同也必须要求类型相同</strong>，在ES中类型Type对应于关系型数据库中表的概念已经名存实亡。实际上在ES中Type作为表的概念在后期版本中越来越被弱化，在未被ES正式移除前，ES后期版本已经不允许一个索引Index创建多个Type，相信在后面的版本会彻底移除类型Type。</p> <p>（注：ES6已经不允许一个Index创建多个Type，<a href="https://github.com/elastic/elasticsearch/pull/24317" target="_blank" rel="noopener noreferrer">https://github.com/elastic/elasticsearch/pull/24317<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）</p> <p>如果在现阶段一定要理解ES中的Type，那么一定要和Mapping结合起来。可以理解为类型Type就是定义一个表，仅仅是定义而已，而映射Mapping定义了表结构（有哪些列，列的类型是什么）。</p> <h3 id="文档document"><a href="#文档document" class="header-anchor">#</a> 文档Document</h3> <p>在非关系型数据库中，有部分被称之为“文档数据库”，对应于关系型数据库中的一行记录。</p> <h3 id="字段field"><a href="#字段field" class="header-anchor">#</a> 字段Field</h3> <p>对应关系型数据库中的列。</p> <h3 id="节点"><a href="#节点" class="header-anchor">#</a> 节点</h3> <p>一个ES实例称之为一个节点，单机部署的ES有且只有一个节点，集群部署的ES有多个节点且有一个主节点。</p> <h3 id="分片"><a href="#分片" class="header-anchor">#</a> 分片</h3> <p>ES可作为分布式集群部署，同样也可以作为单机单节点部署。ES中的数据被分散存储在分片中，ES屏蔽了底层的分片实现，我们直接与索引交互而不与分片交互。分片数量的多少与是否是集群部署和单机部署无关，即使是单机部署在创建索引时仍然也可以指定划分多个分片（默认5个主分片1份备份（包含5个备分片））。分片有主分片和备分片之分，顾名思义，备分片是主分片的备份，当主分片出现故障时，备份片充当主分片。</p> <h4 id="对于单机部署"><a href="#对于单机部署" class="header-anchor">#</a> 对于单机部署</h4> <p>单机部署的ES，即表示ES有且只有一个节点，在创建索引时，如果不指定主分片与备分片的数量，默认创建5个主分片和1份备份（5个备分片），实际上对于单机部署的ES服务来讲，多个主分片并没有意义，多个分片存在的意义本身就是将数据分散存储到多个ES节点中进行同时查询，此时只有一个节点多个分片也没有意义。备分片在单机部署中同样也没有意义，备份存在的意义本身就是当主分片故障时，仍然能对外提供服务，此时主备都在一个节点上，如果主分片故障，备分片也同样会导致故障。</p> <h4 id="对于集群部署"><a href="#对于集群部署" class="header-anchor">#</a> 对于集群部署</h4> <p>对于集群部署的ES来讲，此时存在多个节点，主分片的分配与备分片机制就显得尤为重要（这涉及查询性能以及服务高可用），例如现在有3个节点，此时如果在创建索引时只分配1个主分片就显得有点浪费（注：主分片一旦在创建索引时确定便不能修改）。主分片的划分并没有一定放之四海而皆准的规则，更多的是取决于用户的数据量以及ES节点数量等。通常所理解的是，分片数量越多越好，因为这能将数据分散到不同分片，以便以后在扩容新增节点时，ES能将自动将分片重新进行均匀分布。但这条理论也不绝对，如果你的节点只有3个，设置了100个分片，每个节点就有33个节点，当搜索请求调度到同一节点的不同分片时，此时会引发硬件资源（CPU）的抢夺，造成性能问题。反过来，如果3个节点只分配了3个分片，随着业务的发展，数据量越来越大，单个分片已不能承受它最大的数据量，此时就算新增节点，但是分片数量只有3个，分片的数量在创建索引时便确定且不可修改，此时只能通过重新创建索引。</p> <p>既要对合理的数据增长有一个判断（规划较大的分片），又要对期望有一个度的把握（合理的分片数量）。官方给出了一点建议，每个分片的数据量最好是在20G~40G左右，这就意味着如果你有4个节点，数据量预估在200G左右甚至更大，此时分片数量设置为5~10个比较合适，7、8个差不多，每个节点有2个分片。（官方博客的建议，<a href="https://www.elastic.co/cn/blog/how-many-shards-should-i-have-in-my-elasticsearch-cluster" target="_blank" rel="noopener noreferrer">https://www.elastic.co/cn/blog/how-many-shards-should-i-have-in-my-elasticsearch-cluster<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）</p> <p>上面谈到的是主分片，副分片的划分也同等重要。如果不对分片备份，主分片故障则导致数据丢失，部分数据不可查询。副本分片设置过多造成额外的存储空间，默认情况下，创建索引时会创建一个分片副本（一个分片副本不代表一个备分片，如果有5个主分片，那么分片副本就有5个备分片，同理如果指定创建两个分片副本，此时一共就有10个备分片。）需要注意的是备分片是可以修改的，所以备分片可以直接采用默认一个分片副本。</p> <div class="gitalk-container"><div id="gitalk-container"></div></div> <div class="gitalk-container"><div id="gitalk-container"></div></div> <div class="gitalk-container"><div id="gitalk-container"></div></div> <div class="gitalk-container"><div id="gitalk-container"></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/coderbook/es6/chapter1.html" class="prev">准备工作</a></span> <span class="next"><a href="/coderbook/es6/chapter3.html">简单的API</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/coderbook/assets/js/app.c13df526.js" defer></script><script src="/coderbook/assets/js/2.a6e63a56.js" defer></script><script src="/coderbook/assets/js/10.b2155ceb.js" defer></script><script src="/coderbook/assets/js/4.304fbc0d.js" defer></script>
  </body>
</html>
