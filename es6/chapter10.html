<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>实战：ELK日志分析系统 | CoderBook</title>
    <meta name="description" content="CoderBook">
    
    
    <link rel="preload" href="/coderbook/assets/css/0.styles.414cd468.css" as="style"><link rel="preload" href="/coderbook/assets/js/app.24f4b303.js" as="script"><link rel="preload" href="/coderbook/assets/js/2.a6e63a56.js" as="script"><link rel="preload" href="/coderbook/assets/js/8.7daac39a.js" as="script"><link rel="preload" href="/coderbook/assets/js/4.17ab74bf.js" as="script"><link rel="prefetch" href="/coderbook/assets/js/10.2441ca12.js"><link rel="prefetch" href="/coderbook/assets/js/11.51a52cf0.js"><link rel="prefetch" href="/coderbook/assets/js/12.7f8222e9.js"><link rel="prefetch" href="/coderbook/assets/js/13.0b2c359f.js"><link rel="prefetch" href="/coderbook/assets/js/14.e0069760.js"><link rel="prefetch" href="/coderbook/assets/js/15.901d6d89.js"><link rel="prefetch" href="/coderbook/assets/js/16.75ec35f3.js"><link rel="prefetch" href="/coderbook/assets/js/17.e7a39319.js"><link rel="prefetch" href="/coderbook/assets/js/18.0b6e4e79.js"><link rel="prefetch" href="/coderbook/assets/js/19.fc85f6ab.js"><link rel="prefetch" href="/coderbook/assets/js/3.1f9a9b51.js"><link rel="prefetch" href="/coderbook/assets/js/5.8242e3e9.js"><link rel="prefetch" href="/coderbook/assets/js/6.c52356e8.js"><link rel="prefetch" href="/coderbook/assets/js/7.b5bbb3ab.js"><link rel="prefetch" href="/coderbook/assets/js/9.01cc016a.js">
    <link rel="stylesheet" href="/coderbook/assets/css/0.styles.414cd468.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/coderbook/" class="home-link router-link-active"><!----> <span class="site-name">CoderBook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/coderbook/" class="nav-link">首页</a></div><div class="nav-item"><a href="/coderbook/es6/index.html" class="nav-link">ElasticSearch6.x</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/coderbook/" class="nav-link">首页</a></div><div class="nav-item"><a href="/coderbook/es6/index.html" class="nav-link">ElasticSearch6.x</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/coderbook/es6/" class="sidebar-link">写在前面的话</a></li><li><a href="/coderbook/es6/chapter1.html" class="sidebar-link">准备工作</a></li><li><a href="/coderbook/es6/chapter2.html" class="sidebar-link">基本术语</a></li><li><a href="/coderbook/es6/chapter3.html" class="sidebar-link">简单的API</a></li><li><a href="/coderbook/es6/chapter4.html" class="sidebar-link">分词</a></li><li><a href="/coderbook/es6/chapter5.html" class="sidebar-link">简单搜索</a></li><li><a href="/coderbook/es6/chapter6.html" class="sidebar-link">Java客户端（上）</a></li><li><a href="/coderbook/es6/chapter7.html" class="sidebar-link">父-子关系文档</a></li><li><a href="/coderbook/es6/chapter8.html" class="sidebar-link">复杂搜索</a></li><li><a href="/coderbook/es6/chapter9.html" class="sidebar-link">Java客户端（下）</a></li><li><a href="/coderbook/es6/chapter10.html" class="active sidebar-link">实战：ELK日志分析系统</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/coderbook/es6/chapter10.html#安装部署elk" class="sidebar-link">安装部署ELK</a></li><li class="sidebar-sub-header"><a href="/coderbook/es6/chapter10.html#日志源demo" class="sidebar-link">日志源DEMO</a></li></ul></li><li><a href="/coderbook/es6/chapter11.html" class="sidebar-link">实战：多数据源同步</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="实战：elk日志分析系统"><a href="#实战：elk日志分析系统" class="header-anchor">#</a> 实战：ELK日志分析系统</h1> <p>ElasticSearch、Logstash、Kibana简称ELK系统，主要用于日志的收集与分析。</p> <p>一个完整的大型分布式系统，会有很多与业务不相关的系统，其中日志系统是不可或缺的一个，集中式日志系统需要收集来自不同服务的日志，对它进行集中管理存储以及分析。ELK就是这样一个系统。</p> <p>ElasticSearch是一个开源分布式搜索引擎，在ELK系统中提供对数据的搜索、分析、存储。</p> <p>Logstash主要用于日志的收集，在ELK系统中作为日志数据源的传输。</p> <p>Kibana则是一个可视化管理工具，在ELK系统中起可视化分析查看的作用。</p> <h2 id="安装部署elk"><a href="#安装部署elk" class="header-anchor">#</a> 安装部署ELK</h2> <h3 id="elasticsearch"><a href="#elasticsearch" class="header-anchor">#</a> ElasticSearch</h3> <p>ElasticSearch的安装在&quot;准备工作&quot;中已经说明，这里不再赘述。</p> <h3 id="kibana"><a href="#kibana" class="header-anchor">#</a> Kibana</h3> <p>Kibana6.3.2下载地址（Linux、mac OS、Windows对应不同的版本）：<a href="https://www.elastic.co/cn/downloads/past-releases/logstash-6-3-2" target="_blank" rel="noopener noreferrer">https://www.elastic.co/cn/downloads/past-releases/kibana-6-3-2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。Logstatsh历史版本下载页面：<a href="https://www.elastic.co/cn/downloads/past-releases#kibana" target="_blank" rel="noopener noreferrer">https://www.elastic.co/cn/downloads/past-releases#kibana<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h4 id="mac-os"><a href="#mac-os" class="header-anchor">#</a> mac OS</h4> <ol><li>通过命令<code>tar -zxvf kibana-6.3.2-darwin-x86_64.tar.gz</code>解压到当前用户目录(或者其它位置)。</li> <li>解压后进入<code>kibana-6.3.2-darwin-x86_64</code>目录，执行<code>vim config/kibana.yml</code>命令，修改配置（注意<code>yml</code>格式的配置文件冒号必须有英文空格。</li></ol> <div class="language- extra-class"><pre class="language-text"><code>server.port: 5601
server.host: &quot;localhost&quot;
elasticsearch.url: &quot;http://localhost:9200&quot;
logging.dest: /Users/yulinfeng/log/kibana.log
</code></pre></div><ol start="3"><li>执行<code>./bin/kibana</code>命令启动Kibana。</li></ol> <p>启动完成，打开浏览器输入<code>localhost:5061</code>。</p> <p><img src="resources/kibana.png" alt="kibana"></p> <h4 id="linux"><a href="#linux" class="header-anchor">#</a> Linux</h4> <p>安装过程同mac OS。</p> <h3 id="logstash"><a href="#logstash" class="header-anchor">#</a> Logstash</h3> <p>Logstash6.3.2下载地址（Linux、mac OS、Windows通用，下载zip包即可）：<a href="https://www.elastic.co/cn/downloads/past-releases/logstash-6-3-2" target="_blank" rel="noopener noreferrer">https://www.elastic.co/cn/downloads/past-releases/logstash-6-3-2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。Logstash历史版本下载页面：<a href="https://www.elastic.co/cn/downloads/past-releases#logstash" target="_blank" rel="noopener noreferrer">https://www.elastic.co/cn/downloads/past-releases#logstash<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <h4 id="macos"><a href="#macos" class="header-anchor">#</a> macOS</h4> <ol><li>解压<code>logstash-6.3.2.zip</code> 解压到当前用户目录(或者其它位置)</li> <li>解压后进入<code>logstash-6.3.2</code>目录，执行<code>vim logstash.conf</code>配置文件。</li></ol> <div class="language- extra-class"><pre class="language-text"><code>input {
  tcp {
    mode =&gt; &quot;server&quot;
    host =&gt; &quot;127.0.0.1&quot;
    port =&gt; 4568
  }
}
output {
  elasticsearch {
    hosts =&gt; [&quot;localhost:9200&quot;]
    index =&gt; &quot;log&quot;
    document_type =&gt; &quot;log4j2&quot;
  }
}
</code></pre></div><p>这个配置的含义为，Logstash的日志采集来源是<code>4568</code>端口（后面我们会通过程序代码通过log4j向端口<code>4568</code>打印日志）。Logstash的日志向ElasticSearch输出。</p> <ol start="3"><li>执行<code>./bin/logstash -f logstash.conf</code>命令启动Logstash。</li></ol> <h4 id="linux-2"><a href="#linux-2" class="header-anchor">#</a> Linux</h4> <p>安装过程同mac OS。</p> <h2 id="日志源demo"><a href="#日志源demo" class="header-anchor">#</a> 日志源DEMO</h2> <p>在部署Logstash时，我们定义了日志的来源是端口<code>4568</code>，接下来我们模拟一个程序利用log4j2通过socket连接将日志发送到<code>4568</code>端口，DEMO完整代码地址：<a href="https://github.com/yu-linfeng/elasticsearch6.x_tutorial/tree/master/code/logstash" target="_blank" rel="noopener noreferrer">https://github.com/yu-linfeng/elasticsearch6.x_tutorial/tree/master/code/logstash<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>DEMO的逻辑只有打印日志，主要在<code>log4j2.xml</code>需要配置socket方式打印。</p> <div class="language-xml extra-class"><pre class="language-xml"><code>......
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Socket</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>logstash-tcp<span class="token punctuation">&quot;</span></span> <span class="token attr-name">host</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>localhost<span class="token punctuation">&quot;</span></span> <span class="token attr-name">port</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>4568<span class="token punctuation">&quot;</span></span> <span class="token attr-name">protocol</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>TCP<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>PatternLayout</span> <span class="token attr-name">pattern</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>${LOG_PATTERN}<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Socket</span><span class="token punctuation">&gt;</span></span>
......
</code></pre></div><p>详细代码直接查看源码<a href="https://github.com/yu-linfeng/elasticsearch6.x_tutorial/tree/master/code/logstash" target="_blank" rel="noopener noreferrer">https://github.com/yu-linfeng/elasticsearch6.x_tutorial/tree/master/code/logstash<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。</p> <p>启动Spring Boot程序后，控制台开始输出日志，此时返回浏览器查看<code>localhost:5061</code>，点击<code>Management</code>菜单，<code>Index pattern</code>中输入&quot;log&quot;(即定义的索引Index)，一直下一步即可。</p> <p><img src="resources/kibana-man.png" alt="kibana-man"></p> <p>配置完成后，点击<code>Discover</code>菜单，就可看到程序DEMO打印的日志，并可进行搜索。现在，就请尽情探索吧。</p> <div class="gitalk-container"><div id="gitalk-container"></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/coderbook/es6/chapter9.html" class="prev">Java客户端（下）</a></span> <span class="next"><a href="/coderbook/es6/chapter11.html">实战：多数据源同步</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/coderbook/assets/js/app.24f4b303.js" defer></script><script src="/coderbook/assets/js/2.a6e63a56.js" defer></script><script src="/coderbook/assets/js/8.7daac39a.js" defer></script><script src="/coderbook/assets/js/4.17ab74bf.js" defer></script>
  </body>
</html>
